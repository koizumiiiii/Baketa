# Baketaç¿»è¨³è¨­å®šUI å®Ÿè£…æ‰‹é †ã¨ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å®Œå…¨ã‚¬ã‚¤ãƒ‰

*ä½œæˆæ—¥: 2025å¹´6æœˆ2æ—¥*  
*å¯¾è±¡: Phase 4.1 æœ€å„ªå…ˆå®Ÿè£…é …ç›®*

## ğŸ“š é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

### è¨­è¨ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- [UIè¨­è¨ˆè©³ç´°](./baketa_translation_ui_design.md) - UI/UXãƒ‡ã‚¶ã‚¤ãƒ³ä»•æ§˜ã¨ç”»é¢æ§‹æˆ

### å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«
- [ViewModelã‚µãƒ³ãƒ—ãƒ«å®Ÿè£…](./baketa_translation_viewmodel_implementation.cs) - ViewModelå®Œå…¨å®Ÿè£…ä¾‹
- [DIè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«](./baketa_translation_ui_di_setup.cs) - ä¾å­˜æ€§æ³¨å…¥è¨­å®šã®å®Œå…¨å®Ÿè£…
- [ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«](./baketa_translation_ui_tests.cs) - å˜ä½“ãƒ†ã‚¹ãƒˆãƒ»çµ±åˆãƒ†ã‚¹ãƒˆã®å®Ÿè£…ä¾‹
- [çµ±åˆè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«](./baketa_translation_ui_integration.cs) - ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³çµ±åˆã‚³ãƒ¼ãƒ‰ä¾‹

### XAMLãƒ»ã‚¹ã‚¿ã‚¤ãƒ«
- [å®Œå…¨XAMLå®Ÿè£…](./baketa_translation_ui_xaml_complete.txt) - å…¨ç”»é¢ã®XAMLå®Ÿè£…
- [CodeBehindå®Ÿè£…](./baketa_translation_ui_codebehind.cs) - å¿…è¦ãªCodeBehindå‡¦ç†
- [ã‚¹ã‚¿ã‚¤ãƒ«å®šç¾©](./baketa_translation_ui_complete_styles.txt) - å®Œå…¨ã‚¹ã‚¿ã‚¤ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†
- [SentencePieceçµ±åˆç ”ç©¶ãƒãƒ¼ãƒˆ](../sentencepiece-integration-research.md) - æŠ€è¡“åŸºç›¤ã®è©³ç´°
- [ç¿»è¨³ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ³](../baketa-translation-status.md) - ç¾åœ¨ã®å®Ÿè£…çŠ¶æ³ã¨ã‚¿ã‚¹ã‚¯ç®¡ç†
- [ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹](../../Baketa%20ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹ï¼ˆå®Œå…¨ç‰ˆï¼‰.md) - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã®æŠ€è¡“ä»•æ§˜

## ğŸ“‹ å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### âœ… äº‹å‰æº–å‚™ï¼ˆå¿…é ˆï¼‰

- [ ] **æ—¢å­˜ã‚µãƒ¼ãƒ“ã‚¹ç¢ºèª**: TranslationEngineStatusService ãŒæ­£å¸¸å‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèª
- [ ] **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ ç¢ºèª**: æ—¢å­˜ã®DIè¨­å®šã¨ã‚µãƒ¼ãƒ“ã‚¹ç™»éŒ²ãŒæ­£å¸¸ã«æ©Ÿèƒ½ã™ã‚‹ã“ã¨ã‚’ç¢ºèª  
- [ ] **NuGetãƒ‘ãƒƒã‚±ãƒ¼ã‚¸**: å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒã™ã¹ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª
  - [ ] Avalonia.UI
  - [ ] ReactiveUI.Avalonia
  - [ ] Microsoft.Extensions.Hosting
  - [ ] Microsoft.Extensions.DependencyInjection
  - [ ] System.Reactive

### âœ… Phase 1: åŸºæœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ ï¼ˆ1æ—¥ç›®ï¼‰

#### ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ä½œæˆ

```
Baketa.UI/
â”œâ”€â”€ Views/
â”‚   â””â”€â”€ Settings/
â”‚       â”œâ”€â”€ TranslationSettingsView.axaml
â”‚       â”œâ”€â”€ EngineSelectionControl.axaml
â”‚       â”œâ”€â”€ LanguagePairSelectionControl.axaml
â”‚       â”œâ”€â”€ TranslationStrategyControl.axaml
â”‚       â””â”€â”€ EngineStatusControl.axaml
â”œâ”€â”€ ViewModels/
â”‚   â””â”€â”€ Settings/
â”‚       â”œâ”€â”€ TranslationSettingsViewModel.cs
â”‚       â”œâ”€â”€ EngineSelectionViewModel.cs
â”‚       â”œâ”€â”€ LanguagePairSelectionViewModel.cs
â”‚       â”œâ”€â”€ TranslationStrategyViewModel.cs
â”‚       â””â”€â”€ EngineStatusViewModel.cs
â”œâ”€â”€ Services/
â”‚   â”œâ”€â”€ IUserPlanService.cs
â”‚   â”œâ”€â”€ UserPlanService.cs
â”‚   â”œâ”€â”€ ILocalizationService.cs
â”‚   â”œâ”€â”€ LocalizationService.cs
â”‚   â”œâ”€â”€ INotificationService.cs
â”‚   â””â”€â”€ AvaloniaNotificationService.cs
â”œâ”€â”€ Extensions/
â”‚   â””â”€â”€ UIServiceCollectionExtensions.cs
â”œâ”€â”€ Styles/
â”‚   â””â”€â”€ TranslationSettingsStyles.axaml
â””â”€â”€ Configuration/
    â””â”€â”€ TranslationUIOptions.cs
```

#### å®Ÿè£…æ‰‹é †

1. **ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ**
```bash
mkdir -p Baketa.UI/Views/Settings
mkdir -p Baketa.UI/ViewModels/Settings  
mkdir -p Baketa.UI/Services
mkdir -p Baketa.UI/Extensions
mkdir -p Baketa.UI/Styles
mkdir -p Baketa.UI/Configuration
```

2. **åŸºæœ¬ViewModelãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ**
- ViewModelBase.csï¼ˆæ—¢å­˜ç¢ºèªï¼‰
- TranslationSettingsViewModel.cs
- å„å­ViewModelãƒ•ã‚¡ã‚¤ãƒ«

3. **åŸºæœ¬ã‚µãƒ¼ãƒ“ã‚¹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ä½œæˆ**
- IUserPlanService.cs
- ILocalizationService.cs
- INotificationService.cs

### âœ… Phase 2: DIè¨­å®šã¨ã‚µãƒ¼ãƒ“ã‚¹å®Ÿè£…ï¼ˆ2æ—¥ç›®ï¼‰

#### ã‚µãƒ¼ãƒ“ã‚¹å®Ÿè£…ã®å„ªå…ˆé †ä½

1. **æœ€å„ªå…ˆ**: UserPlanServiceï¼ˆç„¡æ–™/æœ‰æ–™ãƒ—ãƒ©ãƒ³åˆ¤å®šï¼‰
2. **é«˜å„ªå…ˆ**: LocalizationServiceï¼ˆè¨€èªè¨­å®šï¼‰
3. **ä¸­å„ªå…ˆ**: AvaloniaNotificationServiceï¼ˆé€šçŸ¥ï¼‰
4. **ä½å„ªå…ˆ**: ãã®ä»–ã®ãƒ˜ãƒ«ãƒ‘ãƒ¼ã‚µãƒ¼ãƒ“ã‚¹

#### å®Ÿè£…ãƒã‚§ãƒƒã‚¯

- [ ] **UserPlanService**: ç¾åœ¨ã®ãƒ—ãƒ©ãƒ³ã‚¿ã‚¤ãƒ—ã‚’æ­£ç¢ºã«è¿”ã™ã“ã¨ã‚’ç¢ºèª
- [ ] **LocalizationService**: ã‚¢ãƒ—ãƒªè¨€èªè¨­å®šã‚’æ­£ç¢ºã«å–å¾—ã™ã‚‹ã“ã¨ã‚’ç¢ºèª
- [ ] **DIè¨­å®š**: ã™ã¹ã¦ã®ã‚µãƒ¼ãƒ“ã‚¹ãŒæ­£å¸¸ã«è§£æ±ºã§ãã‚‹ã“ã¨ã‚’ç¢ºèª

```csharp
// DIå‹•ä½œãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰
var services = new ServiceCollection();
services.AddTranslationSettingsUI(configuration);
var provider = services.BuildServiceProvider();

// å„ã‚µãƒ¼ãƒ“ã‚¹ãŒæ­£å¸¸ã«è§£æ±ºã§ãã‚‹ã“ã¨ã‚’ç¢ºèª
var translationVM = provider.GetRequiredService<TranslationSettingsViewModel>();
var engineVM = provider.GetRequiredService<EngineSelectionViewModel>();
// ... ä»–ã®ã‚µãƒ¼ãƒ“ã‚¹
```

### âœ… Phase 3: ViewModelå®Ÿè£…ï¼ˆ3-4æ—¥ç›®ï¼‰

#### ViewModelå®Ÿè£…é †åº

1. **EngineSelectionViewModel**ï¼ˆæœ€é‡è¦ï¼‰
   - [ ] ãƒ—ãƒ©ãƒ³åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯
   - [ ] ã‚¨ãƒ³ã‚¸ãƒ³çŠ¶æ…‹ç›£è¦–
   - [ ] ã‚¨ãƒ³ã‚¸ãƒ³åˆ‡ã‚Šæ›¿ãˆå‡¦ç†

2. **LanguagePairSelectionViewModel**
   - [ ] è¨€èªãƒšã‚¢ä¸€è¦§è¡¨ç¤º
   - [ ] ä¸­å›½èªå¤‰ç¨®é¸æŠ
   - [ ] ã‚¢ãƒ—ãƒªè¨€èªé€£å‹•

3. **TranslationStrategyViewModel**
   - [ ] Direct/TwoStageé¸æŠ
   - [ ] ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯è¨­å®š

4. **EngineStatusViewModel**
   - [ ] ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ çŠ¶æ…‹è¡¨ç¤º
   - [ ] ã‚¨ãƒ©ãƒ¼ãƒ»ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯é€šçŸ¥

5. **TranslationSettingsViewModel**ï¼ˆçµ±åˆï¼‰
   - [ ] å­ViewModelã®çµ±åˆ
   - [ ] è¨­å®šä¿å­˜ãƒ»å¾©å…ƒ

#### ãƒ‡ãƒãƒƒã‚°ãƒã‚¤ãƒ³ãƒˆ

```csharp
// ViewModelå‹•ä½œç¢ºèªç”¨ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰
[Test]
public void EngineSelectionViewModel_Construction_ShouldSucceed()
{
    // Arrange
    var mockStatusService = new Mock<ITranslationEngineStatusService>();
    var mockPlanService = new Mock<IUserPlanService>();
    
    // Act & Assert
    Assert.DoesNotThrow(() => 
        new EngineSelectionViewModel(mockStatusService.Object, mockPlanService.Object));
}
```

### âœ… Phase 4: XAML UIå®Ÿè£…ï¼ˆ5-6æ—¥ç›®ï¼‰

#### XAMLå®Ÿè£…é †åº

1. **ã‚¹ã‚¿ã‚¤ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ**: TranslationSettingsStyles.axaml
2. **åŸºæœ¬ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«**: EngineSelectionControl.axaml
3. **è¨€èªè¨­å®š**: LanguagePairSelectionControl.axaml  
4. **æˆ¦ç•¥è¨­å®š**: TranslationStrategyControl.axaml
5. **çŠ¶æ…‹è¡¨ç¤º**: EngineStatusControl.axaml
6. **ãƒ¡ã‚¤ãƒ³ç”»é¢**: TranslationSettingsView.axaml

#### UIå‹•ä½œç¢ºèªé …ç›®

- [ ] **ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°**: ã™ã¹ã¦ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒæ­£ã—ããƒã‚¤ãƒ³ãƒ‰ã•ã‚Œã¦ã„ã‚‹
- [ ] **ã‚³ãƒãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°**: ã™ã¹ã¦ã®ãƒœã‚¿ãƒ³ãƒ»æ“ä½œãŒæ­£å¸¸å‹•ä½œã™ã‚‹
- [ ] **ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³**: ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚µã‚¤ã‚ºå¤‰æ›´ã«é©åˆ‡ã«å¯¾å¿œã™ã‚‹
- [ ] **ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£**: ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒªãƒ¼ãƒ€ãƒ¼å¯¾å¿œ

### âœ… Phase 5: çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆ7æ—¥ç›®ï¼‰

#### çµ±åˆãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª

1. **åŸºæœ¬ãƒ•ãƒ­ãƒ¼**
   - ã‚¢ãƒ—ãƒªèµ·å‹•â†’è¨­å®šç”»é¢è¡¨ç¤ºâ†’ã‚¨ãƒ³ã‚¸ãƒ³é¸æŠâ†’ä¿å­˜

2. **ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹**
   - ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯éšœå®³æ™‚ã®å‹•ä½œ
   - è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ç ´ææ™‚ã®å›å¾©
   - ç„¡åŠ¹ãªè¨­å®šå€¤ã§ã®å‹•ä½œ

3. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**
   - UIå¿œç­”æ€§ï¼ˆè¨­å®šå¤‰æ›´æ™‚ã®é…å»¶ï¼‰
   - ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ï¼ˆé•·æ™‚é–“ä½¿ç”¨æ™‚ï¼‰

## ğŸ”§ ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºç­–

### 1. DIé–¢é€£å•é¡Œ

#### å•é¡Œ: `Unable to resolve service for type 'ITranslationEngineStatusService'`

**åŸå› **: ã‚µãƒ¼ãƒ“ã‚¹ç™»éŒ²ã®é †åºã¾ãŸã¯è¨­å®šãƒŸã‚¹

**è§£æ±ºç­–**:
```csharp
// Program.cs ã¾ãŸã¯ App.xaml.cs ã§æ­£ã—ã„é †åºã§ç™»éŒ²
services.AddSentencePieceTokenizer(configuration);           // 1. åŸºç›¤ã‚µãƒ¼ãƒ“ã‚¹
services.AddChineseTranslationSupport(configuration);       // 2. ç¿»è¨³ã‚µãƒ¼ãƒ“ã‚¹
services.AddCompleteTranslationServices(configuration);     // 3. çµ±åˆã‚µãƒ¼ãƒ“ã‚¹
services.AddTranslationSettingsUI(configuration);          // 4. UIå±¤ã‚µãƒ¼ãƒ“ã‚¹
```

#### å•é¡Œ: Circular dependency detected

**åŸå› **: ViewModelé–“ã®å¾ªç’°å‚ç…§

**è§£æ±ºç­–**:
```csharp
// ç›´æ¥å‚ç…§ã§ã¯ãªãã‚¤ãƒ™ãƒ³ãƒˆçµŒç”±ã§é€šä¿¡
public class TranslationSettingsViewModel : ViewModelBase
{
    private readonly IEventAggregator _eventAggregator;
    
    // å¾ªç’°å‚ç…§ã‚’é¿ã‘ã¦ã‚¤ãƒ™ãƒ³ãƒˆçµŒç”±ã§é€šä¿¡
    private void OnEngineChanged()
    {
        _eventAggregator.PublishAsync(new EngineChangedEvent(selectedEngine));
    }
}
```

### 2. XAML ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°å•é¡Œ

#### å•é¡Œ: ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãŒå‹•ä½œã—ãªã„

**ãƒã‚§ãƒƒã‚¯é …ç›®**:
- [ ] `x:DataType` å±æ€§ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹
- [ ] ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£åã®ã‚¿ã‚¤ãƒãŒãªã„
- [ ] ViewModelãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹

```xml
<!-- æ­£ã—ã„ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ä¾‹ -->
<UserControl xmlns:vm="using:Baketa.UI.ViewModels.Settings"
             x:DataType="vm:EngineSelectionViewModel">
    <TextBlock Text="{Binding SelectedEngineDescription}"/>
</UserControl>
```

#### å•é¡Œ: ã‚³ãƒãƒ³ãƒ‰ãŒå®Ÿè¡Œã•ã‚Œãªã„

**ãƒ‡ãƒãƒƒã‚°æ–¹æ³•**:
```csharp
// ViewModelã§ã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡Œå¯èƒ½æ€§ã‚’ç¢ºèª
public ReactiveCommand<Unit, Unit> SaveCommand { get; }

public TranslationSettingsViewModel()
{
    var canExecute = this.WhenAnyValue(x => x.HasChanges);
    SaveCommand = ReactiveCommand.CreateFromTask(SaveAsync, canExecute);
    
    // ãƒ‡ãƒãƒƒã‚°: ã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡Œå¯èƒ½æ€§ã‚’ãƒ­ã‚°å‡ºåŠ›
    SaveCommand.CanExecute.Subscribe(canExecute => 
        Debug.WriteLine($"SaveCommand CanExecute: {canExecute}"));
}
```

### 3. ReactiveUI é–¢é€£å•é¡Œ

#### å•é¡Œ: `this.RaiseAndSetIfChanged` ãŒå‹•ä½œã—ãªã„

**ç¢ºèªç‚¹**:
- [ ] ViewModelãŒ `ReactiveObject` ã‚’ç¶™æ‰¿ã—ã¦ã„ã‚‹
- [ ] ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒæ­£ã—ãå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹

```csharp
// æ­£ã—ã„å®Ÿè£…ä¾‹
public class EngineSelectionViewModel : ReactiveObject
{
    private TranslationEngine _selectedEngine;
    
    public TranslationEngine SelectedEngine
    {
        get => _selectedEngine;
        set => this.RaiseAndSetIfChanged(ref _selectedEngine, value);
    }
}
```

#### å•é¡Œ: WhenAnyValue ãŒåå¿œã—ãªã„

**è§£æ±ºç­–**:
```csharp
// Disposableã®é©åˆ‡ãªç®¡ç†
public class EngineSelectionViewModel : ReactiveObject, IActivatableViewModel
{
    public ViewModelActivator Activator { get; } = new();
    
    public EngineSelectionViewModel()
    {
        this.WhenActivated(disposables =>
        {
            this.WhenAnyValue(x => x.SelectedEngine)
                .Subscribe(UpdateDescription)
                .DisposeWith(disposables);
        });
    }
}
```

### 4. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å•é¡Œ

#### å•é¡Œ: UIæ›´æ–°ãŒé…ã„

**æœ€é©åŒ–ç­–**:
```csharp
// 1. æ›´æ–°é »åº¦ã®èª¿æ•´
this.WhenAnyValue(x => x.SearchText)
    .Throttle(TimeSpan.FromMilliseconds(300))  // 300msé…å»¶
    .DistinctUntilChanged()                    // åŒã˜å€¤ã®é‡è¤‡æ’é™¤
    .ObserveOn(RxApp.MainThreadScheduler)      // UIã‚¹ãƒ¬ãƒƒãƒ‰ã§å®Ÿè¡Œ
    .Subscribe(ExecuteSearch);

// 2. ãƒãƒƒãƒæ›´æ–°
using (DelayChangeNotifications())
{
    Property1 = value1;
    Property2 = value2;
    Property3 = value3;
    // 1å›ã ã‘é€šçŸ¥ãŒç™ºç”Ÿ
}
```

#### å•é¡Œ: ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯

**å¯¾ç­–**:
```csharp
// IDisposable ã®é©åˆ‡ãªå®Ÿè£…
public class EngineSelectionViewModel : ReactiveObject, IDisposable
{
    private readonly CompositeDisposable _disposables = new();
    private bool _disposed = false;
    
    public EngineSelectionViewModel()
    {
        // ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã‚’CompositeDisposableã«è¿½åŠ 
        statusService.StatusUpdated
            .Subscribe(UpdateStatus)
            .DisposeWith(_disposables);
    }
    
    public void Dispose()
    {
        if (!_disposed)
        {
            _disposables.Dispose();
            _disposed = true;
        }
    }
}
```

## ğŸ§ª ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ–¹æ³•

### 1. å˜ä½“ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

```bash
# ç‰¹å®šã®ViewModelã®ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
dotnet test --filter "ClassName=EngineSelectionViewModelTests"

# ã™ã¹ã¦ã®UIé–¢é€£ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ  
dotnet test --filter "Category=UI"

# ã‚«ãƒãƒ¬ãƒƒã‚¸ä»˜ããƒ†ã‚¹ãƒˆå®Ÿè¡Œ
dotnet test --collect:"XPlat Code Coverage"
```

### 2. çµ±åˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

```bash
# çµ±åˆãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ
dotnet test --filter "Category=Integration"

# ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯ãƒ†ã‚¹ãƒˆ
dotnet test --filter "Category=MemoryLeak" --logger "console;verbosity=detailed"
```

### 3. æ‰‹å‹•ãƒ†ã‚¹ãƒˆãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

#### åŸºæœ¬æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
- [ ] ã‚¢ãƒ—ãƒªèµ·å‹•: è¨­å®šç”»é¢ãŒæ­£å¸¸ã«è¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ã‚¨ãƒ³ã‚¸ãƒ³é¸æŠ: LocalOnly/CloudOnlyåˆ‡ã‚Šæ›¿ãˆãŒæ­£å¸¸å‹•ä½œ
- [ ] è¨€èªãƒšã‚¢: å„è¨€èªãƒšã‚¢ã®æœ‰åŠ¹/ç„¡åŠ¹åˆ‡ã‚Šæ›¿ãˆãŒæ­£å¸¸å‹•ä½œ
- [ ] ä¸­å›½èªè¨­å®š: ç°¡ä½“å­—/ç¹ä½“å­—åˆ‡ã‚Šæ›¿ãˆãŒæ­£å¸¸å‹•ä½œ
- [ ] æˆ¦ç•¥é¸æŠ: Direct/TwoStageåˆ‡ã‚Šæ›¿ãˆãŒæ­£å¸¸å‹•ä½œ
- [ ] è¨­å®šä¿å­˜: è¨­å®šå¤‰æ›´ãŒæ­£å¸¸ã«ä¿å­˜ã•ã‚Œã‚‹
- [ ] è¨­å®šå¾©å…ƒ: ã‚¢ãƒ—ãƒªå†èµ·å‹•å¾Œã«è¨­å®šãŒå¾©å…ƒã•ã‚Œã‚‹

#### ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆ
- [ ] ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åˆ‡æ–­: CloudOnlyã‚¨ãƒ³ã‚¸ãƒ³ã§ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‹•ä½œ
- [ ] è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã§ã®èµ·å‹•
- [ ] ç„¡åŠ¹ãªè¨­å®šå€¤: ã‚¨ãƒ©ãƒ¼å›å¾©ã¨ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤è¨­å®š
- [ ] ãƒ¡ãƒ¢ãƒªä¸è¶³: é©åˆ‡ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

#### UI/UXãƒ†ã‚¹ãƒˆ
- [ ] ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–: ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚µã‚¤ã‚ºå¤‰æ›´ã§ã®é©åˆ‡ãªè¡¨ç¤º
- [ ] ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œ: Tab/Enter/Spaceã§ã®æ“ä½œ
- [ ] é€šçŸ¥è¡¨ç¤º: æˆåŠŸ/ã‚¨ãƒ©ãƒ¼é€šçŸ¥ã®é©åˆ‡ãªè¡¨ç¤º
- [ ] ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£: ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒªãƒ¼ãƒ€ãƒ¼ã§ã®èª­ã¿ä¸Šã’

## ğŸš€ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### 1. èµ·å‹•æ™‚é–“æœ€é©åŒ–

```csharp
// é…å»¶åˆæœŸåŒ–ã®æ´»ç”¨
public class TranslationSettingsViewModel : ViewModelBase
{
    private EngineStatusViewModel? _engineStatus;
    
    public EngineStatusViewModel EngineStatus => 
        _engineStatus ??= _serviceProvider.GetRequiredService<EngineStatusViewModel>();
}
```

### 2. ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡æœ€é©åŒ–

```csharp
// WeakReference ã®æ´»ç”¨
public class EventAggregator : IEventAggregator
{
    private readonly Dictionary<Type, List<WeakReference<IEventHandler>>> _handlers = new();
    
    public void Subscribe<T>(IEventHandler<T> handler) where T : IEvent
    {
        var eventType = typeof(T);
        if (!_handlers.ContainsKey(eventType))
            _handlers[eventType] = new List<WeakReference<IEventHandler>>();
            
        _handlers[eventType].Add(new WeakReference<IEventHandler>(handler));
    }
}
```

### 3. UIæ›´æ–°æœ€é©åŒ–

```csharp
// ãƒãƒ¼ãƒãƒ£ãƒ«åŒ–ã¨ãƒšãƒ¼ã‚¸ãƒ³ã‚°
public class LanguagePairSelectionViewModel : ViewModelBase
{
    private readonly ObservableCollection<LanguagePairItemViewModel> _allPairs;
    
    public ReadOnlyObservableCollection<LanguagePairItemViewModel> VisiblePairs { get; }
    
    public LanguagePairSelectionViewModel()
    {
        // ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã•ã‚ŒãŸã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã®ã¿è¡¨ç¤º
        var filteredPairs = _allPairs
            .ToObservableChangeSet()
            .Filter(pair => pair.IsVisible)
            .ObserveOn(RxApp.MainThreadScheduler);
            
        filteredPairs.Bind(out var visiblePairs).Subscribe();
        VisiblePairs = visiblePairs;
    }
}
```

## ğŸ” ãƒ‡ãƒãƒƒã‚°æ‰‹æ³•

### 1. ãƒ­ã‚°è¨­å®š

```csharp
// appsettings.Development.json
{
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Baketa.UI": "Debug",
      "Baketa.UI.ViewModels": "Trace"
    }
  }
}
```

### 2. ãƒªã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¹ãƒˆãƒªãƒ¼ãƒ ã®ãƒ‡ãƒãƒƒã‚°

```csharp
// Observable ã®ãƒ­ã‚°å‡ºåŠ›
this.WhenAnyValue(x => x.SelectedEngine)
    .Do(engine => Debug.WriteLine($"Engine changed to: {engine}"))
    .Subscribe(UpdateEngineDescription);
```

### 3. ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯ãƒ‡ãƒãƒƒã‚°

```csharp
// ãƒ•ã‚¡ã‚¤ãƒŠãƒ©ã‚¤ã‚¶ãƒ¼ã§ã®ãƒªãƒ¼ã‚¯æ¤œå‡º
public class EngineSelectionViewModel : ReactiveObject, IDisposable
{
    private bool _disposed = false;
    
    ~EngineSelectionViewModel()
    {
        if (!_disposed)
        {
            Debug.WriteLine("âš ï¸ EngineSelectionViewModel ãŒDisposeã•ã‚Œãšã«ç ´æ£„ã•ã‚Œã¾ã—ãŸ");
        }
    }
    
    public void Dispose()
    {
        if (!_disposed)
        {
            // ãƒªã‚½ãƒ¼ã‚¹è§£æ”¾
            _disposed = true;
            GC.SuppressFinalize(this);
        }
    }
}
```

## ğŸ“¦ ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³å±•é–‹æº–å‚™

### 1. è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«æœ€é©åŒ–

```json
// appsettings.Production.json
{
  "Logging": {
    "LogLevel": {
      "Default": "Warning",
      "Baketa": "Information"
    }
  },
  "TranslationUI": {
    "EnableNotifications": true,
    "StatusUpdateInterval": 60000,
    "AutoSaveSettings": true
  }
}
```

### 2. ã‚¨ãƒ©ãƒ¼å ±å‘Šã‚·ã‚¹ãƒ†ãƒ 

```csharp
// ã‚°ãƒ­ãƒ¼ãƒãƒ«ä¾‹å¤–ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
public partial class App : Application
{
    protected override void OnExit(ExitEventArgs e)
    {
        // æœªå‡¦ç†ä¾‹å¤–ã®å ±å‘Š
        AppDomain.CurrentDomain.UnhandledException += (sender, args) =>
        {
            var exception = args.ExceptionObject as Exception;
            LogCriticalError(exception);
        };
        
        base.OnExit(e);
    }
}
```

### 3. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–

```csharp
// ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã®è¨­å®š
public class PerformanceMonitor : IDisposable
{
    private readonly PerformanceCounter _memoryCounter;
    private readonly Timer _monitoringTimer;
    
    public PerformanceMonitor()
    {
        _memoryCounter = new PerformanceCounter("Process", "Working Set", Process.GetCurrentProcess().ProcessName);
        _monitoringTimer = new Timer(LogPerformanceMetrics, null, TimeSpan.Zero, TimeSpan.FromMinutes(5));
    }
    
    private void LogPerformanceMetrics(object? state)
    {
        var memoryUsage = _memoryCounter.NextValue() / 1024 / 1024; // MB
        Debug.WriteLine($"Memory Usage: {memoryUsage:F2} MB");
    }
}
```

## âœ… æœ€çµ‚ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### æ©Ÿèƒ½å®Œæˆåº¦
- [ ] ã™ã¹ã¦ã® ViewModels ãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹
- [ ] ã™ã¹ã¦ã® XAML ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹
- [ ] ã™ã¹ã¦ã®ã‚³ãƒãƒ³ãƒ‰ãŒé©åˆ‡ã«å®Ÿè¡Œã•ã‚Œã‚‹
- [ ] è¨­å®šã®ä¿å­˜ãƒ»å¾©å…ƒãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹
- [ ] ã‚¨ãƒ©ãƒ¼å‡¦ç†ãŒé©åˆ‡ã«å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹

### å“è³ªä¿è¨¼
- [ ] å˜ä½“ãƒ†ã‚¹ãƒˆãŒ90%ä»¥ä¸Šã®ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’é”æˆ
- [ ] çµ±åˆãƒ†ã‚¹ãƒˆãŒã™ã¹ã¦æˆåŠŸ
- [ ] ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯ãŒç™ºç”Ÿã—ãªã„
- [ ] UIå¿œç­”æ€§ãŒä¿ãŸã‚Œã¦ã„ã‚‹ï¼ˆæ“ä½œå¾Œ200msä»¥å†…ï¼‰
- [ ] ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£è¦ä»¶ã‚’æº€ãŸã—ã¦ã„ã‚‹

### ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³æº–å‚™
- [ ] ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ãŒæœ¬ç•ªç’°å¢ƒç”¨ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹
- [ ] ä¾‹å¤–å‡¦ç†ãŒæœ¬ç•ªç’°å¢ƒã§é©åˆ‡ã«å‹•ä½œã™ã‚‹
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹
- [ ] ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒæº–å‚™ã•ã‚Œã¦ã„ã‚‹

---

ã“ã®ã‚¬ã‚¤ãƒ‰ã«å¾“ã£ã¦å®Ÿè£…ã‚’é€²ã‚ã‚‹ã“ã¨ã§ã€**1é€±é–“ç¨‹åº¦ã§å®Œå…¨ã«å‹•ä½œã™ã‚‹ç¿»è¨³è¨­å®šUI**ã‚’æ§‹ç¯‰ã§ãã¾ã™ã€‚

*æœ€çµ‚æ›´æ–°: 2025å¹´6æœˆ2æ—¥*  
*å®Ÿè£…æº–å‚™: å®Œäº† âœ…*