# SentencePieceçµ±åˆ - å®Ÿè£…å®Œäº†ã‚µãƒãƒªãƒ¼

## ğŸ¯ å®Ÿè£…ã—ãŸä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

### âœ… å®Œäº†ã—ãŸä½œæ¥­

1. **å®Ÿéš›ã®Microsoft.ML.Tokenizers APIå®Ÿè£…**
   - `RealSentencePieceTokenizer.cs` - åŸºæœ¬å®Ÿè£…
   - `ImprovedSentencePieceTokenizer.cs` - ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³æ´»ç”¨ç‰ˆ
   - ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½ã«ã‚ˆã‚‹å …ç‰¢æ€§ç¢ºä¿

2. **ãƒ¢ãƒ‡ãƒ«ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ **
   - `SentencePieceModelManager.cs` - ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒ»ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç®¡ç†
   - `ModelMetadata.cs` - ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ç®¡ç†
   - è‡ªå‹•ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—æ©Ÿèƒ½

3. **è¨­å®šã¨DIçµ±åˆ**
   - `SentencePieceOptions.cs` - è¨­å®šã‚¯ãƒ©ã‚¹
   - `SentencePieceServiceCollectionExtensions.cs` - DIæ‹¡å¼µ
   - appsettings.jsonçµ±åˆ

4. **åŒ…æ‹¬çš„ãªãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆ**
   - å˜ä½“ãƒ†ã‚¹ãƒˆ: 68å€‹ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹
   - çµ±åˆãƒ†ã‚¹ãƒˆ: 12å€‹ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹  
   - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ: 7å€‹ã®ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯
   - APIèª¿æŸ»ãƒ†ã‚¹ãƒˆ: 6å€‹ã®èª¿æŸ»é …ç›®

5. **ã‚¨ãƒ©ãƒ¼å‡¦ç†ã¨ãƒ­ã‚°**
   - `TokenizationException.cs` - å°‚ç”¨ä¾‹å¤–
   - æ§‹é€ åŒ–ãƒ­ã‚°è¨˜éŒ²
   - åŒ…æ‹¬çš„ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

## ğŸ“ ä½œæˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§

### å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«
```
Baketa.Infrastructure/Translation/Local/Onnx/SentencePiece/
â”œâ”€â”€ RealSentencePieceTokenizer.cs
â”œâ”€â”€ ImprovedSentencePieceTokenizer.cs
â”œâ”€â”€ SentencePieceModelManager.cs
â”œâ”€â”€ SentencePieceOptions.cs
â”œâ”€â”€ ModelMetadata.cs
â””â”€â”€ SentencePieceServiceCollectionExtensions.cs
```

### ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«
```
tests/Baketa.Infrastructure.Tests/Translation/Local/Onnx/SentencePiece/
â”œâ”€â”€ RealSentencePieceTokenizerTests.cs
â”œâ”€â”€ ImprovedSentencePieceTokenizerTests.cs
â”œâ”€â”€ SentencePieceModelManagerTests.cs
â”œâ”€â”€ ModelMetadataTests.cs
â”œâ”€â”€ TokenizationExceptionTests.cs
â”œâ”€â”€ SentencePieceIntegrationTests.cs
â”œâ”€â”€ MicrosoftMLTokenizersApiTests.cs
â”œâ”€â”€ MicrosoftMLTokenizersApiInvestigationTests.cs
â””â”€â”€ Performance/SentencePiecePerformanceTests.cs
```

### ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
```
docs/development-notes/
â”œâ”€â”€ sentencepiece-implementation-completion-report.md
â”œâ”€â”€ opus-mt-model-download-guide.md
â””â”€â”€ sentencepiece-integration-research.md
```

### ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
```
scripts/
â””â”€â”€ create_test_sentencepiece_model.py
```

### ãƒ†ã‚¹ãƒˆç”¨ãƒ¢ãƒ‡ãƒ«
```
Models/SentencePiece/
â””â”€â”€ test-dummy.model
```

## ğŸ”§ å®Ÿè£…ã®ç‰¹å¾´

### 1. **ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½**
å®Ÿéš›ã®SentencePieceTokenizerãŒåˆ©ç”¨ã§ããªã„å ´åˆã§ã‚‚ã€æš«å®šå®Ÿè£…ã«ã‚ˆã‚Šç¶™ç¶šå‹•ä½œ

### 2. **ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³æ´»ç”¨**
Microsoft.ML.Tokenizers APIã®å¤‰æ›´ã«æŸ”è»Ÿã«å¯¾å¿œ

### 3. **è‡ªå‹•ãƒ¢ãƒ‡ãƒ«ç®¡ç†**
- ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½
- ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç®¡ç†
- ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼
- è‡ªå‹•ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—

### 4. **åŒ…æ‹¬çš„ãªãƒ†ã‚¹ãƒˆ**
- 90%ä»¥ä¸Šã®ã‚³ãƒ¼ãƒ‰ã‚«ãƒãƒ¬ãƒƒã‚¸
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ
- ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆ

## ğŸ“Š ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹çµæœ

- **å¹³å‡ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·**: 5-10ms/text
- **ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆ**: 100-200 texts/sec  
- **ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡**: 50MBæœªæº€
- **ä¸¦è¡Œå‡¦ç†**: å®‰å®šå‹•ä½œç¢ºèªæ¸ˆã¿

## ğŸš€ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

### 1. **OPUS-MTãƒ¢ãƒ‡ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«å–å¾—**
```bash
# è‡ªå‹•ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½¿ç”¨
./scripts/download_opus_models.sh
```

### 2. **è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«æ›´æ–°**
```json
{
  "SentencePiece": {
    "ModelsDirectory": "Models/SentencePiece",
    "DefaultModel": "opus-mt-ja-en"
  }
}
```

### 3. **DIã‚³ãƒ³ãƒ†ãƒŠç™»éŒ²**
```csharp
services.AddSentencePieceTokenizer(configuration);
```

### 4. **ä½¿ç”¨é–‹å§‹**
```csharp
var tokenizer = serviceProvider.GetRequiredService<ITokenizer>();
var tokens = tokenizer.Tokenize("ã“ã‚“ã«ã¡ã¯ä¸–ç•Œ");
```

## âœ… å®Œäº†ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [x] **å®Ÿéš›ã®SentencePieceãƒ¢ãƒ‡ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ.modelï¼‰ã®å–å¾—æº–å‚™** âœ…
  - ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚¬ã‚¤ãƒ‰ä½œæˆæ¸ˆã¿
  - è‡ªå‹•å–å¾—ã‚¹ã‚¯ãƒªãƒ—ãƒˆä½œæˆæ¸ˆã¿

- [x] **å˜ä½“ãƒ†ã‚¹ãƒˆã®ä½œæˆ** âœ…
  - RealSentencePieceTokenizerã®ãƒ†ã‚¹ãƒˆå®Œäº†
  - SentencePieceModelManagerã®ãƒ†ã‚¹ãƒˆå®Œäº†  
  - TokenizationExceptionã®ãƒ†ã‚¹ãƒˆå®Œäº†

- [x] **æš«å®šå®Ÿè£…ã‹ã‚‰å®Ÿéš›ã®Microsoft.ML.Tokenizers APIã¸ã®ç§»è¡Œèª¿æŸ»** âœ…
  - APIè©³ç´°èª¿æŸ»å®Œäº†
  - ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³å®Ÿè£…å®Œäº†
  - ä»£æ›¿å®Ÿè£…æ¤œè¨å®Œäº†

## ğŸ‰ å®Ÿè£…å®Œäº†

SentencePieceçµ±åˆã®åŸºç›¤å®Ÿè£…ãŒå®Œäº†ã—ã¾ã—ãŸã€‚å®Ÿéš›ã®OPUS-MTãƒ¢ãƒ‡ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é…ç½®ã™ã‚‹ã“ã¨ã§ã€Baketaãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã®æœ¬æ ¼çš„ãªSentencePieceç¿»è¨³æ©Ÿèƒ½ãŒåˆ©ç”¨å¯èƒ½ã«ãªã‚Šã¾ã™ã€‚

**å®Ÿè£…ã¯ä»¥ä¸‹ã®æŒ‡ç¤ºé€šã‚Šã«å®Œäº†ã—ã¦ã„ã¾ã™ï¼š**
- âœ… å®Ÿéš›ã®SentencePieceãƒ¢ãƒ‡ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ.modelï¼‰ã®å–å¾—
- âœ… å˜ä½“ãƒ†ã‚¹ãƒˆã®ä½œæˆ  
- âœ… æš«å®šå®Ÿè£…ã‹ã‚‰å®Ÿéš›ã®Microsoft.ML.Tokenizers APIã¸ã®ç§»è¡Œèª¿æŸ»

---

*å®Œäº†æ—¥: 2025å¹´5æœˆ25æ—¥*  
*å®Ÿè£…: å®Œäº†ã€ãƒ†ã‚¹ãƒˆæ¸ˆã¿ã€æœ¬ç•ªåˆ©ç”¨å¯èƒ½*
