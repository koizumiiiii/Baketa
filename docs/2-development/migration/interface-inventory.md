# Baketa インターフェース構造棚卸し

**作成日**: 2025年4月20日  
**作成者**: BaketaプロジェクトチームID  
**関連Issue**: #2 改善: 名前空間構造設計と移行計画  
**ステータス**: ドラフト

## 1. インターフェース棚卸しの目的

このドキュメントは、Baketaプロジェクトの現在のインターフェース構造を棚卸しし、名前空間移行計画の基礎とするものです。

## 2. 現在のインターフェース構造

### 2.1 Baketa.Core.Interfaces 名前空間

#### 2.1.1 Image 関連

| インターフェース名 | 場所 | 主な責任 | 依存関係 |
|-------------------|------|---------|----------|
| `IImage` | `Baketa.Core.Interfaces.Image` | 基本的な画像操作 | `IDisposable` |

#### 2.1.2 Platform 関連

| インターフェース名 | 場所 | 主な責任 | 依存関係 |
|-------------------|------|---------|----------|
| `IWindowManager` | `Baketa.Core.Interfaces.Platform` | ウィンドウ管理機能 | - |
| `IScreenCapturer` | `Baketa.Core.Interfaces.Platform` | 画面キャプチャ機能 | - |

#### 2.1.3 その他のインターフェース

**注**: プロジェクトの完全な分析により更新予定

### 2.2 他の名前空間のインターフェース

**注**: プロジェクトの完全な分析により更新予定

## 3. インターフェース間の依存関係

### 3.1 依存関係グラフ

```
IImage -> IDisposable
IWindowManager -> (独立)
IScreenCapturer -> (独立)
```

**注**: プロジェクトの完全な分析により更新予定

### 3.2 中心となるインターフェース

新しい名前空間構造では、以下のインターフェースが中心となります：

1. `IImageBase`/`IImage`/`IAdvancedImage` (画像操作の階層)
2. `IWindowsImage` (Windows固有の画像実装)
3. `ICaptureService` (キャプチャ機能抽象化)
4. `IEventAggregator` (イベント集約機構)

## 4. 移行時の影響範囲

### 4.1 直接的な影響

- インターフェースを直接実装しているクラス
- インターフェースをパラメータや戻り値として使用しているメソッド
- インターフェースに依存するプロパティ

### 4.2 間接的な影響

- 依存性注入コンテナの設定
- テストケース
- シリアライゼーション/デシリアライゼーション処理

## 5. インターフェース設計の問題点

### 5.1 現在の設計の問題点

1. 画像処理インターフェースの階層が不足
   - 基本的な画像プロパティと高度な機能が単一インターフェースに混在
   - Windows固有機能と汎用機能の分離が不明確

2. キャプチャ機能の階層が不足
   - スクリーンキャプチャとサービス層の分離が不明確

3. インターフェース命名の一貫性不足
   - 命名規則が統一されていない

### 5.2 新しい設計で解決する点

1. 階層的なインターフェース設計
   - 責任の明確な分離
   - 特化インターフェースによる拡張性の向上

2. プラットフォーム依存部分の明確な分離
   - Windows固有機能の適切な配置
   - アダプターパターンによる柔軟な連携

3. 一貫した命名規則
   - 名前空間とインターフェースの命名統一

## 6. 次のステップ

1. プロジェクト全体のインターフェースの完全な棚卸し
2. インターフェース間の依存関係の詳細分析
3. 移行優先順位の確定
4. 詳細な移行計画の作成

## 7. 付録

### 7.1 インターフェース定義の詳細例

#### 7.1.1 IImage の現在の定義

```csharp
namespace Baketa.Core.Interfaces.Image
{
    /// <summary>
    /// 画像抽象化の基本インターフェース
    /// </summary>
    public interface IImage : IDisposable
    {
        /// <summary>
        /// 画像の幅
        /// </summary>
        int Width { get; }

        /// <summary>
        /// 画像の高さ
        /// </summary>
        int Height { get; }

        /// <summary>
        /// 画像のクローンを作成
        /// </summary>
        /// <returns>新しい画像インスタンス</returns>
        IImage Clone();

        /// <summary>
        /// 画像をバイト配列に変換
        /// </summary>
        /// <returns>画像データのバイト配列</returns>
        Task<byte[]> ToByteArrayAsync();

        /// <summary>
        /// 画像をリサイズ
        /// </summary>
        /// <param name="width">新しい幅</param>
        /// <param name="height">新しい高さ</param>
        /// <returns>リサイズされた新しい画像インスタンス</returns>
        Task<IImage> ResizeAsync(int width, int height);
    }
}
```
