# Baketa α版テストガイド

## α版の現状

**完成度**: 約70%  
**基本機能**: 一通り動作  
**期待する品質**: 「普通に使えるけど粗削り」レベル

### 今回見てほしいポイント
- **基本フロー**: キャプチャ→OCR→翻訳→表示の一連の流れ
- **エラーハンドリング**: 失敗時の挙動とレポート生成
- **パフォーマンス**: ゲーム影響とレスポンス性
- **実用性**: 実際のゲームでの使用感

## 技術的背景

### 処理アーキテクチャ
Baketaは5段階のパイプライン処理になってる：

1. **Screen Capture** 
   - Windows Graphics Capture APIとGDI+のハイブリッド
   - GPU環境を自動検出してDirectX対応ゲームは最適化キャプチャ
   - 古いゲームやフルスクリーン非対応時は従来のPrintWindow方式にフォールバック

2. **Image Processing**
   - OCR精度向上のための前処理フィルタ
   - グレースケール変換、ノイズ除去、コントラスト調整など
   - 日本語テキスト特化の画像処理パイプライン

3. **OCR (Optical Character Recognition)**
   - PaddleOCR PP-OCRv5を使用
   - 日本語・英語対応（将来的に多言語対応）
   - 検出信頼度とテキスト座標情報を取得

4. **Translation**
   - NLLB-200 (Meta製多言語翻訳モデル) をローカル実行
   - Gemini API (Google) をクラウド翻訳として併用（未実装）
   - 翻訳結果のメモリキャッシュでレスポンス改善

5. **Overlay Display**
   - Avalonia UIベースの透明オーバーレイ
   - ゲーム画面上にリアルタイム翻訳結果を表示
   - 表示位置・スタイル・透明度をリアルタイム調整

### 新機能：診断レポートシステム
今回のα版から各工程での診断情報を自動収集してる。問題が発生した時に：

- どの工程で失敗したか（キャプチャ？OCR？翻訳？）
- 処理時間はどれくらいかかったか
- エラーの詳細情報
- システム環境情報

これらが自動でJSONファイルに保存される。バグ報告時にこのファイルがあると原因特定が爆速になる予定。

## セットアップ

### システム要件
- **OS**: Windows 10 1903以降 (Graphics Capture API要件)
- **ランタイム**: .NET 8.0 Desktop Runtime
- **VC++**: Visual C++ 2019/2022 Redistributable (x64)
- **メモリ**: 8GB以上推奨
- **Python**: 3.10以上 (NLLB-200用、自動セットアップ)

### インストール
- パッケージ一式をローカルフォルダに展開
- `Baketa.UI.exe`が起動すること
- 初回起動時にPython環境とNLLB-200モデル(約2.4GB)が自動ダウンロード
- 数分かかるけど一度だけの処理

### 動作確認
- 何かしらのウィンドウをキャプチャして翻訳できればOK
- 日本語→英語、英語→日本語あたりで試してもらえれば

## テスト観点

### 基本動作テスト
以下のゲームタイプで動作確認してもらえると：

**推奨テストケース**:
- **フルスクリーンDX11/12**: Apex Legends、FFXIV、原神あたり
- **ウィンドウモード**: Steam版ゲーム各種  
- **古いタイトル**: DirectX9以前やGDI+描画のインディゲーム

**確認項目**:
- テキスト部分を正しくキャプチャできるか
- OCRでテキストを認識できるか（精度は問わない）
- 翻訳結果が表示されるか
- ゲームのフレームレートに影響がないか

### エラーパターン
意図的に以下の状況を作ってエラー処理を確認：

- **ネットワーク切断**: Gemini翻訳中にWiFi切断
- **負荷状況**: CPUやメモリが逼迫した状態での動作
- **GPU切り替え**: ノートPCでの内蔵GPU⇔専用GPU切り替え
- **マルチモニタ**: 複数画面環境での表示位置

### パフォーマンステスト
普段やってるようなパフォーマンス観点で：

- **レスポンス性**: キャプチャから翻訳表示までの体感速度
- **CPU使用率**: タスクマネージャーでBaketa関連プロセス確認
- **メモリ使用量**: 長時間使用での メモリリーク有無
- **ゲーム影響**: FPS低下やスタッター発生の有無

## 既知の問題・制限事項

現時点で把握してる問題（直さなくて良い）：

### UI周り
- 設定画面のレイアウトが適当
- オーバーレイの表示位置調整がやりにくい
- テーマ・スタイル設定が不完全

### 機能面
- OCR精度が低いケースがある（特に装飾フォント）
- 翻訳品質がゲームジャンルに依存
- 一部の古いDirectXゲームでキャプチャ失敗

### パフォーマンス
- NLLB-200初回読み込み時のCPU・メモリスパイク
- 連続翻訳時のわずかなレイテンシ
- GPU切り替え時の一時的な処理停止

これらは想定内なので、別の予期しない問題があれば報告してもらえれば。

## レポート・フィードバック

### 自動診断レポート
問題発生時、以下に診断ファイルが自動生成される：
```
%AppData%\Baketa\Reports\
```

ファイル名例：
- `crash_20250119_143052.json` - アプリクラッシュ
- `translation_error_20250119_143105.json` - 翻訳失敗
- `capture_failure_20250119_143200.json` - キャプチャ失敗

### バグ報告時に欲しい情報
1. **再現手順** - いつものやつ
2. **期待動作と実際の動作** - これもいつものやつ  
3. **テスト環境** - OS、ゲームタイトル、GPU情報など
4. **診断レポートファイル** - 上記の自動生成JSONがあれば添付
5. **スクリーンショット/動画** - 可能であれば

### レポート送信
診断ファイルができた場合、アプリ内の「レポート送信」ボタンから該当フォルダが開くので、そのファイルをDiscordに投げてもらえれば。

普通のフィードバックは気づいた点をいつものようにDiscordで雑に書いてもらえれば。

## 最後に

α版なのでバグがあって当然だし、むしろ問題を見つけてもらうのが目的。

気になる点があったら遠慮なく突っ込んでもらって、使ってみた感想や「こうだったらいいな」みたいなのも歓迎。

よろしく！ 🚀
