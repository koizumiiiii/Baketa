# 改善: アダプターレイヤーの整備

## 概要
プラットフォーム依存コードと抽象化レイヤー間のアダプターを設計・実装し、クリーンなレイヤー分離を実現します。

## 目的・理由
現状では、プラットフォーム固有の実装（Windowsなど）とコア抽象化レイヤーの間の連携が直接的に行われており、結合度が高くなっています。アダプターパターンを導入することで、レイヤー間の疎結合化を図り、テスト容易性と拡張性を向上させます。

## 詳細
- アダプターインターフェースの設計
- WindowsImageAdapter実装の完成
- IImage ⇔ IWindowsImage変換機能の実装
- 他のWindowsコンポーネント用アダプターの実装
- アダプター登録のためのDI拡張の実装

## 実装アプローチ
このIssueでは、各アダプターの実装を**設計**と**実装**の2段階に分けて進めます：

1. **設計フェーズ（A）**:
   - インターフェース設計と抽象クラスの定義
   - 変換メソッド定義
   - スタブ実装の作成

2. **実装フェーズ（B）**:
   - 設計済みインターフェースに基づく実装
   - プラットフォーム固有機能との統合
   - 単体テスト作成

この2段階アプローチにより、プラットフォーム固有コードと抽象化レイヤー間の依存関係を効果的に管理します。

## アダプターパターン実装ガイドライン
1. **責任の分離**:
   - プラットフォーム固有の実装は対応するインターフェースのみに依存
   - アダプターがプラットフォーム実装と抽象化レイヤーの橋渡しを担当

2. **命名規則**:
   - アダプターインターフェース: `I[プラットフォーム名][機能名]Adapter`
   - アダプタークラス: `[プラットフォーム名][機能名]Adapter`
   - 例: `IWindowsImageAdapter`, `WindowsImageAdapter`

3. **実装方針**:
   - アダプターは片方または両方の変換をサポート
   - 変換メソッドは明示的な命名（ToCore/ToPlatformなど）
   - 必要に応じてファクトリーパターンを活用

4. **依存関係の方向**:
   - アダプターはプラットフォーム実装に依存
   - コアレイヤーはアダプターの存在を知らない

## タスク分解
- [ ] 画像アダプターレイヤー
  - [ ] インターフェース設計 (#3-1-A)
  - [ ] 実装完了 (#3-1-B)
- [ ] キャプチャアダプターレイヤー
  - [ ] インターフェース設計 (#3-2-A)
  - [ ] 実装完了 (#3-2-B)
- [ ] ウィンドウマネージャーアダプターレイヤー
  - [ ] インターフェース設計 (#3-3-A)
  - [ ] 実装完了 (#3-3-B)
- [ ] アダプターファクトリーと依存性注入の整備 (#3-4)

## 関連Issue/参考
- 関連: #1 改善: 新インターフェース構造への移行
- 子Issue: #3-1-A 改善: 画像アダプターインターフェース設計
- 子Issue: #3-1-B 改善: 画像アダプター実装完了
- 子Issue: #3-2-A 改善: キャプチャアダプターインターフェース設計
- 子Issue: #3-2-B 改善: キャプチャアダプター実装完了
- 子Issue: #3-3-A 改善: ウィンドウマネージャーアダプターインターフェース設計
- 子Issue: #3-3-B 改善: ウィンドウマネージャーアダプター実装完了
- 子Issue: #3-4 改善: アダプターファクトリーと依存性注入の整備
- 関連: #6 実装: キャプチャサブシステムの実装
- 参照: E:\dev\Baketa\docs\3-architecture\improved-architecture.md (5.4 アダプターの実装例)
- 参照: E:\dev\Baketa\docs\3-architecture\platform\platform-abstraction.md

## マイルストーン
マイルストーン1: アーキテクチャ基盤の改善

## ラベル
- `type: refactor`
- `priority: medium`
- `component: core`