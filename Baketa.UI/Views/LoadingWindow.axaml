<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:Baketa.UI.ViewModels"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:i="using:Avalonia.Xaml.Interactivity"
        xmlns:behaviors="using:Baketa.UI.Behaviors"
        mc:Ignorable="d" d:DesignWidth="600" d:DesignHeight="400"
        x:Class="Baketa.UI.Views.LoadingWindow"
        x:DataType="vm:LoadingViewModel"
        Title="Baketa - Loading..."
        Width="600" MinHeight="400"
        SizeToContent="Height"
        CanResize="False"
        WindowStartupLocation="CenterScreen"
        SystemDecorations="None"
        TransparencyLevelHint="Transparent"
        Background="Transparent">

  <Window.Styles>
    <Style Selector="Window">
      <Setter Property="Opacity" Value="0"/>
    </Style>
    <Style Selector="Window.loaded">
      <Style.Animations>
        <Animation Duration="0:0:0.3" FillMode="Forward">
          <KeyFrame Cue="100%">
            <Setter Property="Opacity" Value="1"/>
          </KeyFrame>
        </Animation>
      </Style.Animations>
    </Style>
  </Window.Styles>

  <Border CornerRadius="12"
          Background="#1E1E1E"
          BorderBrush="#3F3F46"
          BorderThickness="1">
    <!-- Issue #239: ウィンドウドラッグ移動を有効化 -->
    <i:Interaction.Behaviors>
      <behaviors:WindowDragBehavior />
    </i:Interaction.Behaviors>

    <Grid RowDefinitions="Auto,*,Auto" Margin="40">

      <!-- Issue #239: 閉じるボタン（右上に配置） -->
      <Button Grid.Row="0"
              Name="CloseButton"
              HorizontalAlignment="Right"
              VerticalAlignment="Top"
              Margin="0,-28,-28,0"
              Width="32" Height="32"
              CornerRadius="16"
              Background="#27272A"
              BorderThickness="0"
              ToolTip.Tip="Close Application"
              Click="OnCloseButtonClick">
        <TextBlock Text="✕"
                   Foreground="#A1A1AA"
                   FontSize="14"
                   HorizontalAlignment="Center"
                   VerticalAlignment="Center"/>
      </Button>

      <!-- Baketaアイコン (256px) -->
      <Image Grid.Row="0"
             Source="avares://Baketa/Assets/Icons/baketa-256.png"
             Width="128" Height="128"
             HorizontalAlignment="Center"
             Margin="0,0,0,32"/>

      <!-- [Issue #259] 簡素化UI: 統合プログレスバー + Tips -->
      <StackPanel Grid.Row="1"
                  HorizontalAlignment="Stretch"
                  VerticalAlignment="Center"
                  Margin="0,20">

        <!-- 現在のステップメッセージ -->
        <TextBlock Text="{Binding CurrentStepMessage}"
                   Foreground="#E4E4E7"
                   FontSize="14"
                   HorizontalAlignment="Center"
                   TextAlignment="Center"
                   Margin="0,0,0,16"/>

        <!-- 統合プログレスバー -->
        <ProgressBar Value="{Binding OverallProgress}"
                     IsIndeterminate="{Binding IsIndeterminate}"
                     Minimum="0"
                     Maximum="100"
                     Height="6"
                     CornerRadius="3"
                     Foreground="#3B82F6"
                     Background="#27272A"
                     Margin="0,0,0,24"/>

        <!-- Tips表示エリア（フェードアニメーション） -->
        <Border Background="#27272A"
                CornerRadius="8"
                Padding="16,12"
                HorizontalAlignment="Stretch">
          <TextBlock Text="{Binding CurrentTip}"
                     Foreground="#A1A1AA"
                     FontSize="12"
                     HorizontalAlignment="Center"
                     TextAlignment="Center"
                     TextWrapping="Wrap">
            <TextBlock.Transitions>
              <Transitions>
                <DoubleTransition Property="Opacity" Duration="0:0:0.3"/>
              </Transitions>
            </TextBlock.Transitions>
          </TextBlock>
        </Border>
      </StackPanel>

      <!-- フッター -->
      <StackPanel Grid.Row="2"
                  Orientation="Vertical"
                  HorizontalAlignment="Center"
                  Margin="0,32,0,0">
        <TextBlock Text="Baketa - Game Translation Overlay"
                   Foreground="#71717A"
                   FontSize="12"
                   HorizontalAlignment="Center"/>
        <TextBlock Text="{Binding VersionText}"
                   Foreground="#52525B"
                   FontSize="10"
                   HorizontalAlignment="Center"
                   Margin="0,4,0,0"/>
      </StackPanel>
    </Grid>
  </Border>
</Window>
