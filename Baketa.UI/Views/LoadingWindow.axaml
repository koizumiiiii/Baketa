<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:Baketa.UI.ViewModels"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d" d:DesignWidth="600" d:DesignHeight="400"
        x:Class="Baketa.UI.Views.LoadingWindow"
        x:DataType="vm:LoadingViewModel"
        Title="Baketa - Loading..."
        Width="600" MinHeight="400"
        SizeToContent="Height"
        CanResize="False"
        WindowStartupLocation="CenterScreen"
        SystemDecorations="None"
        TransparencyLevelHint="Transparent"
        Background="Transparent">

  <Window.Styles>
    <Style Selector="Window">
      <Setter Property="Opacity" Value="0"/>
    </Style>
    <Style Selector="Window.loaded">
      <Style.Animations>
        <Animation Duration="0:0:0.3" FillMode="Forward">
          <KeyFrame Cue="100%">
            <Setter Property="Opacity" Value="1"/>
          </KeyFrame>
        </Animation>
      </Style.Animations>
    </Style>
  </Window.Styles>

  <Border CornerRadius="12"
          Background="#1E1E1E"
          BorderBrush="#3F3F46"
          BorderThickness="1">
    <Grid RowDefinitions="Auto,*,Auto" Margin="40">

      <!-- Baketaアイコン (256px) -->
      <Image Grid.Row="0"
             Source="avares://Baketa.UI/Assets/Icons/baketa-256.png"
             Width="128" Height="128"
             HorizontalAlignment="Center"
             Margin="0,0,0,32"/>

      <!-- 初期化ステップリスト -->
      <ItemsControl Grid.Row="1"
                    ItemsSource="{Binding InitializationSteps}"
                    HorizontalAlignment="Stretch"
                    VerticalAlignment="Center">
        <ItemsControl.ItemTemplate>
          <DataTemplate>
            <StackPanel Margin="0,6">
              <Grid ColumnDefinitions="Auto,*">
                <!-- ステータスアイコン -->
                <Border Grid.Column="0"
                        Width="24" Height="24"
                        CornerRadius="12"
                        Background="{Binding StatusColor}"
                        Margin="0,0,16,0">
                  <TextBlock Text="{Binding StatusIcon}"
                             Foreground="White"
                             FontSize="12"
                             HorizontalAlignment="Center"
                             VerticalAlignment="Center"/>
                </Border>

                <!-- メッセージ -->
                <TextBlock Grid.Column="1"
                           Text="{Binding Message}"
                           Foreground="#E4E4E7"
                           FontSize="14"
                           VerticalAlignment="Center"/>
              </Grid>

              <!-- プログレスバー（実行中のステップで表示） -->
              <StackPanel IsVisible="{Binding IsInProgress}"
                          Margin="40,4,0,0">
                <!-- [Issue #185] 詳細メッセージ (ダウンロード進捗など) -->
                <TextBlock Text="{Binding DetailMessage}"
                           Foreground="#A1A1AA"
                           FontSize="12"
                           TextWrapping="NoWrap"
                           TextTrimming="CharacterEllipsis"
                           IsVisible="{Binding HasDetailMessage}"/>
                <!-- プログレスバー（不確定アニメーション対応） -->
                <ProgressBar Value="{Binding Progress}"
                             IsIndeterminate="{Binding IsIndeterminate}"
                             Minimum="0"
                             Maximum="100"
                             Height="4"
                             Margin="0,4,0,0"
                             Foreground="#3B82F6"
                             Background="#27272A"/>
              </StackPanel>
            </StackPanel>
          </DataTemplate>
        </ItemsControl.ItemTemplate>
      </ItemsControl>

      <!-- フッター -->
      <StackPanel Grid.Row="2"
                  Orientation="Vertical"
                  HorizontalAlignment="Center"
                  Margin="0,32,0,0">
        <TextBlock Text="Baketa - Game Translation Overlay"
                   Foreground="#71717A"
                   FontSize="12"
                   HorizontalAlignment="Center"/>
        <TextBlock Text="{Binding VersionText}"
                   Foreground="#52525B"
                   FontSize="10"
                   HorizontalAlignment="Center"
                   Margin="0,4,0,0"/>
      </StackPanel>
    </Grid>
  </Border>
</Window>
