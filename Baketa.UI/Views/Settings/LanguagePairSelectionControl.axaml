<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:Baketa.UI.ViewModels.Settings"
             xmlns:converters="using:Baketa.UI.Converters"
             mc:Ignorable="d" d:DesignWidth="600" d:DesignHeight="500"
             x:Class="Baketa.UI.Views.Settings.LanguagePairSelectionControl"
             x:DataType="vm:LanguagePairSelectionViewModel">

  <Design.DataContext>
    <vm:LanguagePairSelectionViewModel />
  </Design.DataContext>

  <Border Classes="Card">
    <StackPanel Spacing="16">
      <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
      <Grid ColumnDefinitions="*,Auto">
        <TextBlock Grid.Column="0"
                   Text="è¨€èªžãƒšã‚¢é¸æŠž" 
                   FontWeight="SemiBold" 
                   FontSize="16" />
        <Button Grid.Column="1"
                Classes="Icon"
                Command="{Binding RefreshLanguagePairsCommand}"
                ToolTip.Tip="è¨€èªžãƒšã‚¢ã‚’æ›´æ–°">
          <TextBlock Text="ðŸ”„" FontSize="14" />
        </Button>
      </Grid>

      <!-- æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
      <Border Classes="SearchBox">
        <Grid ColumnDefinitions="Auto,*,Auto">
          <TextBlock Grid.Column="0" 
                     Text="ðŸ”" 
                     FontSize="14" 
                     VerticalAlignment="Center"
                     Margin="8,0,0,0" />
          <TextBox Grid.Column="1"
                   Text="{Binding FilterText}"
                   Watermark="è¨€èªžãƒšã‚¢ã‚’æ¤œç´¢..."
                   Classes="Borderless"
                   Margin="4,0,0,0" />
          <Button Grid.Column="2"
                  Classes="Icon Clear"
                  Command="{Binding ClearFilterCommand}"
                  IsVisible="{Binding FilterText, Converter={x:Static converters:StringToBoolConverter.Instance}}"
                  ToolTip.Tip="æ¤œç´¢ã‚’ã‚¯ãƒªã‚¢">
            <TextBlock Text="âœ•" FontSize="12" />
          </Button>
        </Grid>
      </Border>

      <!-- è¨€èªžãƒšã‚¢ä¸€è¦§ -->
      <ScrollViewer MaxHeight="300" VerticalScrollBarVisibility="Auto">
        <ItemsControl ItemsSource="{Binding LanguagePairs}">
          <ItemsControl.ItemTemplate>
            <DataTemplate>
              <Border Classes="LanguagePairItem" Margin="0,0,0,8">
                <Grid ColumnDefinitions="Auto,*,Auto,Auto">
                  <!-- è¨€èªžãƒ•ãƒ©ã‚° -->
                  <StackPanel Grid.Column="0" 
                              Orientation="Horizontal" 
                              Spacing="4"
                              VerticalAlignment="Center">
                    <TextBlock Text="{Binding SourceLanguage, Converter={x:Static converters:LanguageToFlagConverter.Instance}}"
                               FontSize="16" />
                    <TextBlock Text="â†’" FontSize="12" Opacity="0.6" />
                    <TextBlock Text="{Binding TargetLanguage, Converter={x:Static converters:LanguageToFlagConverter.Instance}}"
                               FontSize="16" />
                  </StackPanel>

                  <!-- è¨€èªžãƒšã‚¢æƒ…å ± -->
                  <StackPanel Grid.Column="1" 
                              Spacing="2" 
                              Margin="12,0,0,0"
                              VerticalAlignment="Center">
                    <TextBlock Text="{Binding DisplayName}"
                               FontWeight="Medium" 
                               FontSize="13" />
                    <TextBlock Text="{Binding Description}"
                               FontSize="11"
                               Opacity="0.7"
                               TextTrimming="CharacterEllipsis" />
                  </StackPanel>

                  <!-- é¸æŠžãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ -->
                  <RadioButton Grid.Column="2"
                               GroupName="LanguagePair"
                               IsChecked="{Binding $parent[ItemsControl].((vm:LanguagePairSelectionViewModel)DataContext).SelectedLanguagePair, Converter={x:Static converters:ObjectEqualsConverter.Instance}, ConverterParameter={Binding}}"
                               Command="{Binding $parent[ItemsControl].((vm:LanguagePairSelectionViewModel)DataContext).SelectLanguagePairCommand}"
                               CommandParameter="{Binding}"
                               VerticalAlignment="Center"
                               Margin="8,0,0,0" />

                  <!-- æœ‰åŠ¹/ç„¡åŠ¹ãƒˆã‚°ãƒ« -->
                  <ToggleSwitch Grid.Column="3"
                                IsChecked="{Binding IsEnabled}"
                                Command="{Binding $parent[ItemsControl].((vm:LanguagePairSelectionViewModel)DataContext).ToggleLanguagePairCommand}"
                                CommandParameter="{Binding}"
                                ToolTip.Tip="è¨€èªžãƒšã‚¢ã®æœ‰åŠ¹/ç„¡åŠ¹ã‚’åˆ‡ã‚Šæ›¿ãˆ"
                                Width="48"
                                Height="24"
                                Margin="8,0,0,0" />
                </Grid>
              </Border>
            </DataTemplate>
          </ItemsControl.ItemTemplate>
        </ItemsControl>
      </ScrollViewer>

      <!-- ä¸­å›½èªžå¤‰ç¨®é¸æŠž -->
      <Border Classes="ChineseVariantSection" IsVisible="{Binding IsChineseRelatedPair}">
        <StackPanel Spacing="12">
          <TextBlock Text="ä¸­å›½èªžå¤‰ç¨®é¸æŠž" 
                     FontWeight="Medium" 
                     FontSize="13" />
          
          <ItemsControl ItemsSource="{Binding AvailableChineseVariants}">
            <ItemsControl.ItemsPanel>
              <ItemsPanelTemplate>
                <StackPanel Orientation="Horizontal" Spacing="12" />
              </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>
            <ItemsControl.ItemTemplate>
              <DataTemplate>
                <Border Classes="ChineseVariantOption">
                  <RadioButton GroupName="ChineseVariant"
                               IsChecked="{Binding $parent[ItemsControl].((vm:LanguagePairSelectionViewModel)DataContext).SelectedChineseVariant, Converter={x:Static converters:EnumToBoolConverter.Instance}, ConverterParameter={Binding Variant}}"
                               Command="{Binding $parent[ItemsControl].((vm:LanguagePairSelectionViewModel)DataContext).SelectChineseVariantCommand}"
                               CommandParameter="{Binding Variant}">
                    <StackPanel Orientation="Horizontal" Spacing="6">
                      <TextBlock Text="{Binding Flag}" FontSize="16" />
                      <StackPanel>
                        <TextBlock Text="{Binding DisplayName}" 
                                   FontSize="12" 
                                   FontWeight="Medium" />
                        <TextBlock Text="{Binding NativeName}" 
                                   FontSize="10" 
                                   Opacity="0.7" />
                      </StackPanel>
                    </StackPanel>
                  </RadioButton>
                </Border>
              </DataTemplate>
            </ItemsControl.ItemTemplate>
          </ItemsControl>
          
          <TextBlock Text="é¸æŠžã—ãŸå¤‰ç¨®ã¯ä¸­å›½èªžé–¢é€£ã®ç¿»è¨³ã«é©ç”¨ã•ã‚Œã¾ã™"
                     FontSize="11"
                     Opacity="0.6"
                     FontStyle="Italic" />
        </StackPanel>
      </Border>

      <!-- é¸æŠžä¸­ã®è¨€èªžãƒšã‚¢æƒ…å ± -->
      <Border Classes="SelectedPairInfo" IsVisible="{Binding SelectedLanguagePair, Converter={x:Static converters:ObjectToBoolConverter.Instance}}">
        <StackPanel Spacing="8">
          <TextBlock Text="é¸æŠžä¸­ã®è¨€èªžãƒšã‚¢" 
                     FontWeight="Medium" 
                     FontSize="13" />
          <Grid ColumnDefinitions="*,*,*,*">
            <StackPanel Grid.Column="0" Spacing="2">
              <TextBlock Text="è¨€èªžãƒšã‚¢" FontSize="11" Opacity="0.7" />
              <TextBlock Text="{Binding SelectedLanguagePair.DisplayName}" 
                         FontSize="12" 
                         FontWeight="Medium" />
            </StackPanel>
            <StackPanel Grid.Column="1" Spacing="2">
              <TextBlock Text="ç¿»è¨³æˆ¦ç•¥" FontSize="11" Opacity="0.7" />
              <TextBlock Text="{Binding SelectedLanguagePair.Strategy, Converter={x:Static converters:StrategyToDisplayConverter.Instance}}" 
                         FontSize="12" 
                         FontWeight="Medium" />
            </StackPanel>
            <StackPanel Grid.Column="2" Spacing="2">
              <TextBlock Text="æŽ¨å®šãƒ¬ã‚¤ãƒ†ãƒ³ã‚·" FontSize="11" Opacity="0.7" />
              <TextBlock Text="{Binding SelectedLanguagePair.LatencyDisplayText}" 
                         FontSize="12" 
                         FontWeight="Medium" />
            </StackPanel>
            <StackPanel Grid.Column="3" Spacing="2" IsVisible="{Binding SelectedLanguagePair.IsChineseRelated}">
              <TextBlock Text="ä¸­å›½èªžå¤‰ç¨®" FontSize="11" Opacity="0.7" />
              <TextBlock Text="{Binding SelectedChineseVariant, Converter={x:Static converters:ChineseVariantToDisplayConverter.Instance}}" 
                         FontSize="12" 
                         FontWeight="Medium" />
            </StackPanel>
          </Grid>
        </StackPanel>
      </Border>

      <!-- çµ±è¨ˆæƒ…å ± -->
      <Border Classes="StatsInfo">
        <Grid ColumnDefinitions="*,*,*">
          <StackPanel Grid.Column="0" Spacing="2">
            <TextBlock Text="åˆ©ç”¨å¯èƒ½" FontSize="11" Opacity="0.7" />
            <TextBlock Text="{Binding LanguagePairs.Count}" 
                       FontSize="14" 
                       FontWeight="Bold" />
          </StackPanel>
          <StackPanel Grid.Column="1" Spacing="2">
            <TextBlock Text="æœ‰åŠ¹" FontSize="11" Opacity="0.7" />
            <TextBlock FontSize="14" FontWeight="Bold">
              <TextBlock.Text>
                <Binding Path="LanguagePairs" Converter="{x:Static converters:EnabledCountConverter.Instance}" />
              </TextBlock.Text>
            </TextBlock>
          </StackPanel>
          <StackPanel Grid.Column="2" Spacing="2">
            <TextBlock Text="é¸æŠžä¸­" FontSize="11" Opacity="0.7" />
            <TextBlock Text="{Binding SelectedLanguagePair.LanguagePairKey, FallbackValue='ãªã—'}" 
                       FontSize="14" 
                       FontWeight="Bold" />
          </StackPanel>
        </Grid>
      </Border>

      <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º -->
      <Border Classes="LoadingIndicator" IsVisible="{Binding IsLoading}">
        <Grid ColumnDefinitions="Auto,*">
          <Border Grid.Column="0" Classes="Spinner" />
          <TextBlock Grid.Column="1" 
                     Text="è¨€èªžãƒšã‚¢ã‚’èª­ã¿è¾¼ã¿ä¸­..."
                     FontSize="12"
                     VerticalAlignment="Center"
                     Margin="8,0,0,0" />
        </Grid>
      </Border>
    </StackPanel>
  </Border>

</UserControl>
