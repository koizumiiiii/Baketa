# Baketa プロジェクト コードレビューチェックリスト

## アーキテクチャ準拠性

### クリーンアーキテクチャ依存関係
- [ ] **依存関係の方向性**: 上位層から下位層への依存のみ（UI → Application → Infrastructure → Core）
- [ ] **レイヤー分離**: 各レイヤーが適切に分離され、責務が明確
- [ ] **AbstractionsとInterfaces**: `Baketa.Core.Abstractions`を使用（旧`Interfaces`は非推奨）
- [ ] **Cross-cutting concerns**: EventAggregator、ログ、設定管理の適切な使用

### DI（依存性注入）パターン
- [ ] **ServiceModuleBase継承**: DI モジュールが`ServiceModuleBase`を継承
- [ ] **循環依存なし**: サービス間の循環依存が存在しない
- [ ] **適切なライフタイム**: Singleton、Transient、Scopedの適切な選択
- [ ] **インターフェース経由**: 具象クラスではなくインターフェース経由で依存

### レイヤー別チェック
- [ ] **Core層**: プラットフォーム依存コードが含まれていない
- [ ] **Infrastructure層**: ビジネスロジックが含まれていない
- [ ] **Application層**: UI関連コードが含まれていない
- [ ] **UI層**: ビジネスロジックがViewModelに含まれていない

## C# 12 / .NET 8 準拠性

### C# 12 必須機能
- [ ] **ファイルスコープ名前空間**: 新規ファイルでファイルスコープ名前空間を使用
- [ ] **プライマリコンストラクター**: 単純なクラスでプライマリコンストラクターを活用
- [ ] **コレクション式**: `[]`構文を使用（`new List<>()`の代わり）
- [ ] **パターンマッチング**: 最新のパターンマッチング機能を活用

### 非同期プログラミング
- [ ] **ConfigureAwait(false)**: ライブラリコードで必須（テストは除く）
- [ ] **CancellationToken**: 適切な伝播と使用
- [ ] **async/await**: I/O操作で正しく使用
- [ ] **Task.Run回避**: UIスレッドからのCPU集約的処理の適切な処理

### Nullable Reference Types
- [ ] **Nullable有効**: プロジェクトでNullable Reference Typesが有効
- [ ] **null許容性**: 適切なnull許容型の使用
- [ ] **null チェック**: 必要な箇所でnullチェックが実装

## Baketa 固有チェック

### OCR処理
- [ ] **メモリ管理**: IDisposableの適切な実装とリソース解放
- [ ] **エラーハンドリング**: OCR失敗時の適切なエラーハンドリング
- [ ] **パフォーマンス**: 2秒以内の処理完了目標
- [ ] **キャッシュ戦略**: SHA256ハッシュとLRU evictionの適切な実装

### 翻訳エンジン
- [ ] **ITranslationEngine実装**: インターフェースの正しい実装
- [ ] **API エラーハンドリング**: 外部API（Gemini等）のエラー処理
- [ ] **フォールバック機能**: 翻訳失敗時の代替手段
- [ ] **レート制限**: API制限の適切な考慮

### ReactiveUI パターン
- [ ] **ViewModelBase継承**: ViewModelが`ViewModelBase`を継承
- [ ] **プロパティ変更通知**: `INotifyPropertyChanged`の適切な実装
- [ ] **Observable使用**: ReactiveUIのObservableパターンの正しい使用
- [ ] **バリデーション**: ReactiveUI.Validationフレームワークの活用

### P/Invoke とネイティブ相互運用
- [ ] **DllImport宣言**: 正しいDllImportとマーシャリング
- [ ] **セーフハンドル**: ネイティブリソースのセーフハンドル使用
- [ ] **メモリ安全性**: unsafe codeの適切な使用
- [ ] **プラットフォーム固有**: Windows固有コードの適切な分離

### イベントシステム
- [ ] **IEvent実装**: イベントクラスが`IEvent`を実装
- [ ] **EventProcessor**: `IEventProcessor<TEvent>`の適切な実装
- [ ] **EventAggregator**: イベント発行と購読の正しい使用
- [ ] **メモリリーク**: イベントハンドラーのメモリリーク回避

## パフォーマンスと品質

### メモリ管理
- [ ] **Span<T>とMemory<T>**: メモリ効率的な操作での使用
- [ ] **オブジェクトプール**: 頻繁に作成されるオブジェクトのプール利用
- [ ] **大容量データ**: 大容量画像やテキストの適切な処理
- [ ] **ガベージコレクション**: GC圧迫の回避

### エラーハンドリング
- [ ] **例外の種類**: 適切な例外型の使用
- [ ] **例外メッセージ**: 有用なエラーメッセージ
- [ ] **ログ出力**: 適切なログレベルでの出力
- [ ] **回復可能性**: 可能な場合のエラー回復処理

### セキュリティ
- [ ] **入力検証**: 外部入力の適切な検証
- [ ] **機密情報**: APIキー等の機密情報の適切な管理
- [ ] **SQL インジェクション**: （該当する場合）SQLインジェクション対策
- [ ] **パス操作**: ファイルパス操作の安全性

## テストカバレッジ

### 単体テスト
- [ ] **xUnit使用**: xUnitテストフレームワークの使用
- [ ] **Moq使用**: モッキングでMoqの使用
- [ ] **AAA パターン**: Arrange-Act-Assertパターンの遵守
- [ ] **テスト命名**: 意味のあるテストメソッド名

### 統合テスト
- [ ] **レイヤー間テスト**: レイヤー間の統合テスト
- [ ] **UI テスト**: Avaloniaテストフレームワークの使用
- [ ] **エンドツーエンド**: 主要機能のE2Eテスト
- [ ] **パフォーマンステスト**: 性能要件の検証

## ドキュメンテーション

### コードドキュメンテーション
- [ ] **XMLドキュメント**: パブリックAPIのXMLドキュメント
- [ ] **自己文書化**: 明確な命名による自己文書化
- [ ] **コメント最小限**: 必要最小限のコメント
- [ ] **TODO/FIXME**: 未完了作業の適切なマーキング

### 設定ファイル
- [ ] **appsettings構造**: 適切な設定ファイル構造
- [ ] **環境別設定**: Development/Production設定の分離
- [ ] **設定検証**: 設定値の妥当性検証
- [ ] **デフォルト値**: 適切なデフォルト値の設定

## チェックリスト使用方法

1. **レビュー前**: 該当する項目を特定
2. **レビュー中**: 各項目を順次チェック
3. **レビュー後**: 未チェック項目の課題を特定
4. **フォローアップ**: 修正が必要な項目の対応

## 重要度レベル

- **🔴 Critical**: アーキテクチャ違反、セキュリティ問題、メモリリーク
- **🟡 Important**: パフォーマンス問題、保守性の問題
- **🟢 Nice to have**: コード品質向上、スタイル統一

## 自動チェック対応項目

以下の項目は`code-review.ps1`スクリプトで自動チェック可能：
- ファイルスコープ名前空間の使用
- ConfigureAwait(false)の使用
- Abstractionsインターフェースの使用
- 循環依存の検出
- セキュリティパターンの検出

手動レビューが必要な項目：
- ビジネスロジックの正しさ
- アーキテクチャの適切性
- ユーザビリティ
- 総合的な設計判断